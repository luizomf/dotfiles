# TERM1 - THIS OPTION WORKED WITH NO PROBLEM FOR MONTHS
# Set the default terminal
# set -g default-terminal "xterm-ghostty"
# set-option -ga terminal-overrides ",tmux-256color:RGB"
# END OF TERM1

# TERM2 - THIS IS A NEW OPTION I AM TESTING (I MAY REMOVE IT LATTER)
# Sets the TERM value for the terminal *inside* of tmux
set -g default-terminal "tmux-256color"
# Adds True Color (RGB) support for the terminal *outside* of tmux
set -ga terminal-features ",xterm-ghostty:Tc"
# END OF TERM2

# enable activity alerts
setw -g monitor-activity off
set -g visual-activity off

# Aumenta o hist√≥rico
set-option -g history-limit 10000
# Habilita o modo vi em todas as intera√ß√µes (navega√ß√£o, sele√ß√£o etc)
set-option -g mode-keys vi

# Navega entre os pain√©is com prefix + hjkl (N√£o recomendo, colide com outras)
# bind l select-pane -L
# bind j select-pane -D
# bind k select-pane -U
# bind l select-pane -R

# Permite navegar sem prefixo (n√£o recomendo e nem funciona direito)
# bind -r C-h select-pane -L
# bind -r C-j select-pane -D
# bind -r C-k select-pane -U
# bind -r C-l select-pane -R

# Ativa o mouse (rolar, clicar, redimensionar, etc)
set -g mouse off
set -g renumber-windows on
# tmux move-window -r

# Permite selecionar texto em modo copy-mode (Ctrl + b [) e copiar com 'y'
# Copia direto pro clipboard do macOS usando pbcopy
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Sugest√£o: usa 'v' pra entrar no modo visual (como no Vim)
# (J√° funciona por padr√£o com mode-keys vi, mas fica expl√≠cito aqui)
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# Opcional: redefine prefixo pra Ctrl+a se quiser (igual GNU screen)
# set -g prefix C-a
# unbind C-b
# bind C-a send-prefix

# Show when prefix is pressed
# set -g status-left "#{?client_prefix,PREFIX,}"

# <prefix> r (reload) - Recarrega o .tmux.conf
bind r run-shell -b '\
  tmux source-file ~/.tmux.conf ; \
  tmux display-message "Config reloaded üåÄ..."; \
'

# <prefix> Ctrl+l (Lista) - Lista se√ß√µes com fzf
bind C-l run-shell '\
  tmux list-window -a -F "##S:##I ##W ##P ##D" | 
  fzf --sync --tmux center |  
  awk "{print \$1}" | 
  xargs tmux switch-client -t 
'

# Popup Keybinds (Abre algo em uma janela de popup tempor√°ria)
# <prefix> Ctrl+n (anota√ß√µes tempor√°rias) - Abre o nvim com /tmp/scrach.md
bind-key C-n display-popup -E -w 60% -h 60% "nvim /tmp/scratch.md"
# <prefix> Ctrl+p (Python REPL) - Abre o REPL do Python (quit fecha)
bind-key C-p display-popup -E -w 60% -h 60% "python"
# <prefix> Ctrl+h (htop) - Abre o htop (q fecha)
bind-key C-h display-popup -E -w 80% -h 80% "htop"
# <prefix> Ctrl+t (terminal) - Abre o terminal normal em um popup
bind-key C-t display-popup -E -w 80% -h 80%

#
# Mostra e oculta um popup 
# https://gist.github.com/LintaoAmons/22f6184b26bd5b93d8fe9f9276f50f75
# <prefix> Ctrl+w (Toggle popup) - Abre um popup / Esconde o popup
bind-key -r C-w run-shell -b '\
    popup_id="popup_$(tmux display-message -p "##{session_id}" | cut -d"\$" -f2)"; \
    if test "$(echo #{session_name} | cut -d"_" -f 1)" = "popup" ; then \
        tmux detach-client; \
    else \
        tmux popup -d "#{pane_current_path}" -xC -yC -w80% -h75% \
            -E "tmux attach -t \"${popup_id}\" || tmux new -s \"${popup_id}\" "; \
    fi; \
'
# 

# Inicia as session do 1
set -g base-index 1 # start windows numbering at 1
set -g pane-base-index 1 # start pane numbering at 1

# Set status bar color
set -g status-style "fg=black,bg=cyan"

# Set window title color
set -g window-status-format "#[fg=black,bg=cyan] #I:#W "

# Set active window title color
set -g window-status-current-format "#[fg=white,bg=black] #I:#W "

# Set status left content
set -g status-left ""
set -g status-right " #[fg=default,bg=default]#S #D "

# --- Gerenciador de Plugins (TPM) ---
# Lista de plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible' # Configura√ß√µes sensatas padr√£o
set -g @plugin 'tmux-plugins/tmux-resurrect' # Salva e restaura sess√µes
set -g @plugin 'tmux-plugins/tmux-continuum' # Restaura√ß√£o autom√°tica

# Configura√ß√£o do Continuum
set -g @continuum-restore 'on' # Habilita a restaura√ß√£o autom√°tica ao iniciar o tmux
# Salva em 5min
set -g @continuum-save-interval '5'

# Inicializa o TPM (deve ser a √∫ltima linha da configura√ß√£o do tmux)
run '~/.tmux/plugins/tpm/tpm'

