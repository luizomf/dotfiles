# Sets the TERM value for the terminal inside of tmux
set -g default-terminal "tmux-256color"
# Adds True Color (RGB) support for the terminal *outside* of tmux
set -ga terminal-features ",xterm-ghostty:Tc"

# enable activity alerts
set -g monitor-activity on
set -g visual-bell off
set -g visual-activity off
set -g visual-silence off

# Aumenta o hist√≥rico (tamanho do buffer da janela)
set-option -g history-limit 30000
# Habilita o modo vi em todas as intera√ß√µes 
set-option -g mode-keys vi

# Ativa o mouse (rolar, clicar, redimensionar, etc)
# N√£o estou usando
set -g mouse off
set -g renumber-windows on # Reorganiza os √≠ndices das janelas
# tmux move-window -r

# Inicia as session do k
set -g base-index 1 # windows
set -g pane-base-index 1 # panes

# Adiciona o t√≠tulo no terminal
set -g set-titles on
# WIP Below (I am trying to find a good balance here)
# set -g set-titles-string '#S | #I:#W (#D) | #T (#{b:pane_current_path}) #{session_alerts}'
set -g set-titles-string '#{?client_prefix,üÖøÔ∏è,} #S | #I:#W (#D) | #T #{session_alerts}'

# Permite selecionar texto em modo copy-mode (Ctrl + b [) e copiar com 'y'
# Copia direto pro clipboard do macOS usando pbcopy
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Usa v para modo visual (expl√≠cito)
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# Redefine prefixo pra Ctrl+a se quiser (igual GNU screen)
# N√£o uso
# set -g prefix C-a
# unbind C-b
# bind C-a send-prefix

# <prefix> r (reload) - Recarrega o .tmux.conf
bind r run-shell -b '\
  tmux source-file ~/.tmux.conf ; \
  tmux display-message "Config reloaded üåÄ..."; \
'

# <prefix> Ctrl+l (Lista) - Lista se√ß√µes com fzf
bind C-l run-shell '\
  tmux list-window -a -F "##S:##I ##W ##P ##D" | 
  fzf --sync --tmux center |  
  awk "{print \$1}" | 
  xargs tmux switch-client -t 
'

# Popup Keybinds (Abre algo em uma janela de popup tempor√°ria)
# <prefix> Ctrl+n (anota√ß√µes tempor√°rias) - Abre o nvim com /tmp/scrach.md
bind-key C-n display-popup -E -w 60% -h 60% "nvim /tmp/scratch.md"
# <prefix> Ctrl+p (Python REPL) - Abre o REPL do Python (quit fecha)
bind-key C-p display-popup -E -w 60% -h 60% "python"
# <prefix> Ctrl+h (htop) - Abre o htop (q fecha)
bind-key C-h display-popup -E -w 80% -h 80% "htop"
# <prefix> Ctrl+t (terminal) - Abre o terminal normal em um popup
bind-key C-t display-popup -E -w80% -h80% ""
# <prefix> Ctrl+x (just run) - Roda o just com recipe run (ESC sai)
bind-key C-x display-popup -w80% -h80% "just run"

#
# Mostra e oculta um popup 
# https://gist.github.com/LintaoAmons/22f6184b26bd5b93d8fe9f9276f50f75
# <prefix> Ctrl+w (Toggle popup) - Abre um popup / Esconde o popup
bind-key -r C-w run-shell -b '\
    popup_id="popup_$(tmux display-message -p "##{session_id}" | cut -d"\$" -f2)"; \
    if test "$(echo #{session_name} | cut -d"_" -f 1)" = "popup" ; then \
        tmux detach-client; \
    else \
        tmux popup -d "#{pane_current_path}" -xC -yC -w80% -h75% \
            -E "tmux attach -t \"${popup_id}\" || tmux new -s \"${popup_id}\" "; \
    fi; \
'

# NOVO TEMA
set -g status-left-style NONE
set -g status-right-style NONE

set -g prompt-cursor-colour white
set -g status-left-length 100
set -g status-left "#{?client_prefix,#[fg=white bg=black] ‚úº  #[default],#[fg=white dim bg=black] -  #[default]}#[fg=black,bg=green]ÓÇ∞#[default]"

set -g status-right-length 30
set -g status-right "#[default]#[fg=black,bg=green]ÓÇ≤#[default]#[fg=white bg=black] #S #D #[default]"

setw -g window-status-activity-style ''

set -g mode-style "fg=green,bg=black"

set -g message-style "fg=green,bg=black"
set -g message-command-style "fg=green,bg=black"

set -g status "on"
set -g status-justify "left"

set -g status-style "fg=black,bg=green"

setw -g window-status-separator ""
setw -g window-status-style "NONE,fg=black,bg=green"
setw -g window-status-format "#[fg=green,bg=green]ÓÇ∞#[default] #I:#W #F #[fg=green,bg=green]ÓÇ∞#[default]"
setw -g window-status-current-format "#[fg=green,bg=black]ÓÇ∞#[fg=white,bg=black] #I:#W #F #[fg=black,bg=green]ÓÇ∞#[default]"

# Gerenciador de Plugins (TPM)
# Lista de plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible' # Configura√ß√µes sensatas padr√£o
set -g @plugin 'tmux-plugins/tmux-resurrect' # Salva e restaura sess√µes
set -g @plugin 'tmux-plugins/tmux-continuum' # Restaura√ß√£o autom√°tica

# Configura√ß√£o do Continuum
set -g @continuum-restore 'on' # Habilita a restaura√ß√£o autom√°tica ao iniciar o tmux
# Salva em 5min
set -g @continuum-save-interval '5'

# Inicializa o TPM (deve ser a √∫ltima linha da configura√ß√£o do tmux)
run '~/.tmux/plugins/tpm/tpm'

